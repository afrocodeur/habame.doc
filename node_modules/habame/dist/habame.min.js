var Habame=function(){"use strict";const t="default",e="yield-fragment",n="__IS_PROXY_PROPERTY__",o="__PROXY_TARGET_LABEL__",r="prevent",i="stop",s=function(){const t=this,e={};this.emit=function(t,o){if(!e[t])return;const r=(o||[]).map((t=>t[n]?t.toObject():t));e[t].forEach((t=>{t.apply(t,r)}))},this.create=function(e){const n={emit:function(){t.emit(e,Array.from(arguments))}};return void 0!==this[e]?null:(Object.defineProperty(this,e,{get:()=>n}),n)},this.disconnect=function(){for(const t in e)e[t].splice(0)},this.addEventListener=function(t,n){return"function"!=typeof n?null:(e[t]=e[t]||[],e[t].push(n),n)},this.on=this.addEventListener,this.removeEventListener=function(t,n){if(void 0===e[t])return;const o=e[t],r=o.indexOf(n);r<0||o.splice(r,1)},this.clearAll=function(){for(const t in e)e[t].splice()}},c=["push","pop","shift","unshift","sort","reverse","splice"],u=function(t,e){if(!t||"object"!=typeof t)return t;e.path=e.path||[];for(const n in t)if("object"==typeof t[n]){const o=u(t[n],{...e,path:[...e.path,n]});Array.isArray(t[n])&&(t[n]=o)}let r=[];return Array.isArray(t)?r=c:t&&t.MUTATORS&&(r=t.MUTATORS),new Proxy(t,{get(i,s){if(s===n)return!0;if("__PROXY_STATE_ITEM__"===s)return e.$stateItem;if(s===o)return t;const c=i[s];return"function"==typeof c?function(){const t=c.apply(i,Array.from(arguments));return r.includes(s)&&e.$stateItem.trigger(),t}:"toObject"===s&&void 0===t.toObject?()=>JSON.parse(JSON.stringify(i)):c},set(t,o,r){const i=[...e.path,o].join("."),s=t[o];if("object"==typeof r){if(r===t[o])return;r&&!0===r[n]&&(r=JSON.parse(JSON.stringify(r)));const i=u(r,e);t[o]=Array.isArray(r)?i:r}else t[o]=r;e.onSet&&e.onSet(i,s,r)}})},a=function(t,e){return t&&"object"==typeof t&&e?t[n]?t:u(t,{path:[],$stateItem:e,onSet:function(t,n,o){e.handleUpdate(t,n,o)}}):t},f=function(t,e,r){const i={default:"object"==typeof e?JSON.parse(JSON.stringify(e)):e,current:null,last:e},s=[],c={},u=()=>{r&&r.isSwitchOff()||s.forEach((t=>{t.apply(t,[i.current,i.last])}))};this.set=(t,e=!0)=>t!==i.current&&((!i.current||!i.current[n]||t!==i.current[o])&&(i.last=i.current,i.current=a(t,this),e&&u(),!0)),this.value=function(){return i.current},this.getLastValue=function(){return i.last},this.getInitialValue=function(){return i.default},this.getName=function(){return t},this.onUpdate=function(t){return s.push(t),t},this.handleUpdate=function(t,e,n){this.trigger(),((t,e,n)=>{if(r&&r.isSwitchOff())return;const o=c[t];o&&o.forEach((t=>{t.apply(t,[e,n])}))})(t,e,n)},this.watch=function(t,e){c[t]=e},this.trigger=function(){u()},this.disconnect=function(t){const e=s.indexOf(t);e<0||s.splice(e,1)},this.reset=function(){this.set(i.default)},i.current=a(e,this)},h=function(t={},e={}){const o=e=>{const o=t[e].value();return o[n]?o.toObject():o},r=t=>{this[t]=o(t)},i=()=>{for(const e in t)["onUpdate","all","getSlot"].includes(e)||r(e)};this.exists=function(e){return Object.keys(t).includes(e)},this.add=function(e,n){this.exists(e)||(t[e]=n,n.onUpdate(i),r(e))},this.onUpdate=function(e,n){if(void 0===t[e])throw new Error("undefined props "+e);return t[e].onUpdate(n),{disconnect:function(){t[e].disconnect(n)}}},this.disconnect=function(e,n){t[e]?.disconnect(n)},this.all=function(){const e={};for(const n in t)e[n]=o(n);return e},this.getSlot=function(t){return e?e[t]:null},this.updateSlots=function(t){e=t},this.getTemplate=function(e){return t[e]},(()=>{i();for(const e in t)t[e].onUpdate(i)})()},l=function(t={},e){const o={},r=[],i={enable:!0,observer:null,listenersToHandle:new Set},s={props:null,only:null,callbacks:{}},c=t=>{i.enable?r.forEach((({names:e,listener:n})=>{if(!e)return;e.some((e=>t.includes(e)))&&n.apply(n,[])})):i.observer&&i.observer(this)&&this.switchOn()};this.add=function(t,e){if(o[t]){const n=o[t];return n.set(e),n}const n=new f(t,e,this);return n.onUpdate((()=>c([t]))),o[t]=n,Object.defineProperty(this,t,{configurable:!0,get:()=>n.value(),set(t){n.set(t)}}),n},this.switchOff=function(t){i.enable=!1,i.observer=t},this.isSwitchOff=function(){return!1===i.enable||this.parent&&this.parent.isSwitchOff()},this.switchOn=function(){i.enable=!0;const t=[...i.listenersToHandle];i.listenersToHandle.clear(),t.forEach((({state:t,variables:e})=>t.trigger(e)))},this.init=function(t){for(const e in t)this.add(e,t[e])},this.refreshProps=function(){s.props&&this.useProps(s.props,s.only)},this.useProps=function(t,e=null){if(!(t instanceof h))throw new Error("State.useProps require a ComponentProps instance");s.props=t,s.only=e;const o=t.all();for(const r in o){if(Array.isArray(e)&&!e.includes(r))continue;if(s.callbacks[r])return;const i=this.add(r,o[r]);s.callbacks[r]=t.onUpdate(r,((t,e)=>{i.set(t),(t[n]||t===e)&&i.trigger()}))}},this.disconnectProps=function(t){if(!s)return;let e=[...t];if(!t||0===t.length){const t=s.props.all();e=Object.keys(t)}e.forEach((function(t){s.callbacks[t]&&s.callbacks[t].disconnect()}))},this.useService=function(t,n=[]){if("string"==typeof t&&!(t=e.Services[t]))throw new Error(`Undefined service ${t}`);const o=t.$serviceState;if(!(o&&o instanceof l))throw new Error("Invalid service provide to useService");const r=o.getStateNames();for(const t of r){if(n&&n.length&&!n.includes(t))continue;const e=o.get(t),r=this.add(t,e.value());e.onUpdate(((t,e)=>{r.set(t),t===e&&r.trigger()}))}return t},this.set=function(t){let e=!1;for(const n in t){if(void 0===o[n])throw new Error("Undefined State: "+n+" is not declared as state");o[n].set(t[n],!1)&&(e=!0)}e&&c(Object.keys(t))},this.trigger=function(t){c(t)},this.edit=async function(t,e){"function"==typeof e&&("AsyncFunction"===e.constructor.name&&await e(),e&&e()),c(t)},this.exists=function(t){return void 0!==o[t]},this.getStateWith=function(t){return void 0!==o[t]?this:this.parent?this.parent.getStateWith(t):null},this.getValues=function(t){const e={};return t.forEach((t=>{const n=this.get(t);e[t]=n.value()})),e},this.getAll=function(){return this.getValues(this.getStateNames())},this.get=function(t){return void 0===o[t]&&this.parent?this.parent.get(t):o[t]},this.getStateNames=function(){return Object.keys(o)},this.reset=function(){for(const t of o)t.reset()},this.addListener=function(t,e,n){const o={names:t,listener:e,remove:!1};return n?r.unshift(o):r.push(o),o},this.onUpdate=function(t,e,n=!1){const o=t.filter((t=>!this.exists(t))),r=this.addListener(t,e,n);if(0===o.length)return e;const s=[];return o.forEach((t=>{const e=this.getStateWith(t);if(!e)return;const n=s.find((({state:t})=>t===e));n?n.variables.push(t):s.push({state:e,variables:[t]})})),0===s.length||s.forEach((({state:t,variables:n})=>{const o={variables:n,state:t};t.onUpdate(n,(()=>{r.remove||(!this.isSwitchOff()||i.observer&&i.observer(this)?e.apply(e,Array.from(arguments)):i.listenersToHandle.add(o))}))})),e},this.removeOnUpdateListenerFromParent=function(t){return this.parent?this.parent.removeOnUpdateListener(t):null},this.removeOnUpdateListener=function(t){const e=r.findIndex((e=>e.listener===t));-1!==e&&(r.splice(e,1),this.removeOnUpdateListenerFromParent(t))},this.unlock=function(){},this.disconnect=function(){r.splice(0),i.listenersToHandle.clear()},this.lock=function(){},(()=>{if(t)for(const e in t)this.add(e,t[e])})()},p=function(t){const e=t.getStateToUse(),n=t.componentInstance.getActions();this.getRequestedVars=function(t,o=!0){const r=[],i=[],s=t.replace(/('.*?')|(".*?")/g,"").match(/[a-z_0-9$_.]+/gi)?.map((t=>t.split(".").shift().trim())).reduce(((t,e)=>/^[a-z$_]+/i.test(e)?(t.includes(e)||t.push(e),t):t),[]);return s&&s.forEach((t=>{void 0!==e.get(t)?r.push(t):void 0!==n[t]&&i.push(t)})),o?r:{states:r,actions:i}}},d=function(t,e,n=!1,o=!1){const r=this;p.apply(this,[e]);const i=[];let s=[],c=null,u={source:null,transformed:null};const a=()=>{i.forEach((t=>{t.apply(t,[this.value()])}))};this.onUpdate=function(t){return i.push(t),t},this.statesToWatch=function(){return s},this.disconnect=function(t){const e=i.indexOf(t);e<0||i.splice(e,1)},this.value=function(t){if(!c)return;const n={};for(const o of s){if(t&&void 0!==t[o]){n[o]=t[o];continue}const r=e.getState(o,u.transformed);r&&(n[o]=r.value())}return c(n)},this.refresh=function(i=null,f=!1){if((i=null===i?t:i)===u.source)return;const h=e.getStateToUse();if(!0===f&&e.localState&&e.localState.disconnect(),!i)return u.source=i,void(c=null);let l=i.trim().replace(/^\{\{|}}$/g,"").trim();l=function(t){const e=/^([a-z0-9.$_]+)\.\.([a-z0-9.$_]+)$/i;if(e.test(t)){const n=t.match(e);if(n.shift(),2!==n.length)throw new Error("Range error");const[o,r]=n;t="Array.from({ length: "+r+"}, function(value, index) { return index + "+o+"; })"}return s=r.getRequestedVars(t),t}(l);try{let t="return "+l+";";n&&(t=" try { "+t+" } catch(e) { return "+o+"; }"),c=new Function("states",(s.length?"const {"+s.join(",")+"} = states;":"")+t)}catch(t){throw new Error("Syntax error : "+l)}u.transformed=l,u.source=i,f&&a(),s.length&&h.onUpdate(s,a)},(()=>{this.refresh()})()},m=function(t,e){let n=[],o=[],r=null;const i=!n.some((t=>t.hasAState));this.isStateLess=function(){return i},this.each=function(t){n.forEach((e=>{t.apply(t,[e])}))},this.refresh=function(i){i!==r&&(n=(i||t).split(/(\{\{.+?\}\})/).map((t=>{const n=/(^\{\{.+?\}\}$)/.test(t);return{value:t,hasAState:n,template:n?new d(t,e):null}})),o=n.reduce((function(t,e){if(!e.hasAState)return t;return e.template.statesToWatch().forEach((e=>{t.includes(e)||t.push(e)})),t}),[]),r=i)},this.statesToWatch=function(){return o},(()=>{this.refresh(t)})()},g=function(t,e){const n=new d(t,e,!0),o=[],r=function(){o.forEach((t=>{t.apply(t,[!!n.value()])}))};this.watch=function(t){return o.push(t),t},this.isTrue=function(){return!0==!!n.value()},this.trigger=r,this.isFalse=function(){return!1==!!n.value()},this.loadStateWatcher=function(){const t=e.getStateToUse(),o=n.statesToWatch();t.removeOnUpdateListener(r),t.onUpdate(o,r,!0)},this.refresh=function(t){n.refresh(t),this.loadStateWatcher()},(()=>{this.loadStateWatcher()})()},v=function({$viewDescription:t,$callbacks:e}){const{getIfStatement:n,buildIfStatement:o}=e;this.updateIfControl=function(e){let r=n();if(!r){if(!e)return;return r=o(e),void r.trigger()}r.refresh(e||"true"),r.trigger(),t.if=e}},w=function({$viewDescription:t,$viewProps:e,$isFragment:n}){const o={isRendered:!1,isUnmount:!1,isRemoved:!1};let r=null;const i={anchorsFragment:document.createDocumentFragment(),anchorParent:null,selfFragment:document.createDocumentFragment(),anchor:null,parent:null},s=()=>r.isTrue(),c=t=>t?r?null:(r=new g(t,e),r.watch((t=>{e.localState&&(t?e.localState.switchOn():e.localState.switchOff(s)),t?this.mount():this.unmount()})),r):null;this.render=function(e){e&&!this.isRendered()&&(!0!==n&&c(t.if),this.beforeRenderProcess&&this.beforeRenderProcess(),this.renderProcess(e,r),r&&r.isFalse()?this.setIsUnmounted():(this.setIsMounted(),this.setIsRendered()))},this.insertAfter=function(t,e){const n=e.nextSibling;e.parentNode&&(n?e.parentNode.insertBefore(t,n):e.parentNode.appendChild(t))},this.mount=function(){o.isUnmount&&this.mountProcess&&this.mountProcess(r)},this.unmount=function(t=!1){o.isUnmount&&!0!==t||this.unmountProcess&&this.unmountProcess(t)},this.remove=function(){o.isRemoved||this.removeProcess&&this.removeProcess()},this.setIsRendered=function(){o.isRendered=!0},this.setIsMounted=function(){o.isUnmount=!1},this.setIsRemoved=function(){o.isRemoved=!0},this.setIsNotRemoved=function(){o.isRemoved=!1},this.setIsUnmounted=function(){o.isUnmount=!0},this.isRendered=function(){return o.isRendered},this.isRemoved=function(){return o.isRemoved},this.setParent=function(t){i.parent=t},this.setAnchor=function(t){i.anchor=t},this.unmountAnchors=function(t,e){i.anchorParent=t,Array.isArray(e)?e.forEach((t=>{i.anchorsFragment.appendChild(t)})):i.anchorsFragment.appendChild(e)},this.mountAnchors=function(){i.anchorParent&&i.anchorParent.appendChild(i.anchorsFragment),i.anchorParent=null},this.moveIntoFragment=function(t){Array.isArray(t)?t.forEach((t=>{i.selfFragment.appendChild(t)})):i.selfFragment.appendChild(t)},this.moveIntoParent=function(t=!1){i.parent||t?i.parent.appendChild(i.selfFragment):i.anchor&&this.insertAfter(i.selfFragment,i.anchor)},this.unMountedFragment=function(){return i.selfFragment},this.getViewDescription=function(){return t},this.updateViewDescription=()=>{},this.updateIfControl=()=>{},v.apply(this,[{$viewDescription:t,$callbacks:{getIfStatement:()=>r,buildIfStatement:c}}])},y=function({$viewDescription:t,$viewDescriptionDetails:e,$htmlTextNodes:n,$textNodes:o,callbacks:r}){const{createConnexion:i,getParentNode:s}=r,c=function(){n.forEach((t=>{t.remove()})),n.splice(0);let t=[...o];e.each((e=>{let r=e.hasAState?e.template.value():e.value;const s=t.find((t=>t.partValue===r)),c=s?s.htmlTextNode:document.createTextNode(r);n.push(c),s?t=t.filter((t=>t===s)):o.push({partValue:r,htmlTextNode:c}),!s&&e.hasAState&&i(c,e)})),(()=>{const t=s();n.forEach((e=>{t.appendChild(e)}))})()};this.updateViewDescription=function(n){n!==t&&(e.refresh(n),c())}},b=function(t,e){w.call(this,{$viewDescription:t,$viewProps:e});const n=new m(t,e),o=[],r=[];let i=null;const s=function(t,e){e.template.onUpdate((e=>{e!==t.textContent&&(t.textContent=e)}))};this.renderProcess=function(t){i=t,this.isRendered()||(n.each((t=>{let e=t.hasAState?t.template.value():t.value;const n=document.createTextNode(e);o.push(n),r.push({partValue:e,htmlTextNode:n}),t.hasAState&&s(n,t)})),this.setParent(t),o.forEach((e=>{t.appendChild(e)})),this.setIsRendered())},this.unmountProcess=function(){this.moveIntoFragment(o),this.setIsUnmounted()},this.mountProcess=function(){this.moveIntoParent(),this.setIsMounted()},this.removeProcess=function(){o.forEach((t=>t.remove())),this.setIsRemoved()},y.apply(this,[{$viewDescription:t,$viewDescriptionDetails:n,$htmlTextNodes:o,$textNodes:r,callbacks:{createConnexion:s,getParentNode:()=>i}}])},S=function(t,e){const n=this;p.apply(this,[e]);let o={};const r=e.getStateToUse(),i=e.componentInstance.getActions();let s=null,c=null;this.handle=function(t,e=null){s.apply(i,[r,o.states,i,t,e])},this.refresh=function(t){if(t!==c){o=this.getRequestedVars(t,!1),i[t]&&(t+=".apply(actions, (Array.isArray($args) ? $args : [$event]))");try{let e="return "+t+";";const{states:n,actions:r}=o;s=new Function("state","states","actions","$event","$args",(n.length?"const {"+n.join(",")+"} = state.getValues(states);":"")+(r.length?"const {"+r.join(",")+"} = actions;":"")+e),c=t}catch(e){throw new Error("Syntax error : "+t)}}},(()=>{n.refresh(t);const o=()=>{i[t]&&(c=null,this.refresh(t),e.componentInstance.removeControllerUpdatedListener(o))};i[t]||e.componentInstance.onControllerUpdated(o)})()},E=function({$viewDescription:t,$componentEventActions:e,$viewProps:n,$slotManagers:o,$callbacks:r}){const{getProps:i,getElement:s,getHbEvent:c,buildEvent:u,getSlotManagerObject:a}=r;this.updateViewDescription=function(r){!function(e){const o=i();if(!o)return;Object.keys(t.props).forEach((t=>{if(!e[t]){const e=o.getTemplate(t);e&&e.disconnect()}}));const r=s().getState(),c=[];for(const t in e){if(o.exists(t)){c.push(t);continue}const i=new d(e[t],n);o.add(t,i),r.useProps(o,[t])}c.forEach((function(t){o.getTemplate(t).refresh(e[t],!0)}))}(r.props),function(n){const o=c();if(o){Object.keys(t.events).forEach((t=>{const r=e[t];n[t]?r.template.refresh(n[t]):o.removeEventListener(r.name,r.callback)}));for(const t in n){if(e[t])continue;const o=n[t];u(t,o)}}}(r.events),function(e){e.content||e.slots?(t.slots&&Object.keys(t.slots).forEach((t=>{if(!e.slots||!e.slots[t])return o[t].deleteInstances(),void(o[t]=null);o[t].updateViewDescription(e.slots[t])})),e.content?t.content?o.default.updateViewDescription(e.content):o.default=a(e.content):t.content&&(o.default.deleteInstances(),o.default=null),Object.keys(e.slots).forEach((n=>{t.slots[n]||(o[n]=a(e[n]))}))):Object.keys(o).forEach((t=>{o[t].deleteInstances(),o[t]=null}))}(r),function(){const t=i();if(!t)return;const e={};Object.keys(o).forEach((()=>{o[name]&&(e[name]=o[name].builder)})),t.updateSlots(e)}();["content","slots","events","props"].forEach((e=>{t[e]=r[e]}))}},$=function(t,e){w.call(this,{$viewDescription:t,$viewProps:e});const n=document.createComment("");let o=null,r=null,i=null,s={},c={};const u=function(t){const n=[];return{updateViewDescription:function(e){t=e,n.forEach((t=>{t.updateViewDescription(e)}))},deleteInstances:function(){n.forEach((t=>{t.remove()}))},builder:function(o,r){const i=r(t.props),s={...e};i&&(i.parent=e.getStateToUse(),s.localState=i);const c=new M(t,s);return c.render(o),n.push(c),c}}},a=function(){const e={};if(t.content){const n=u(t.content);e.default=n.builder,c.default=n}if(!t.slots)return e;for(const n in t.slots){const o=u(t.slots[n]);c[n]=o,e[n]=o.builder}return e},f=()=>{const n=e.componentInstance.getActions();if(t.events&&n){i=o.getHbEvent();for(const e in t.events){const n=t.events[e];l(e,n)}}},l=function(t,n){const o=new S(n,e),r=function(){const t=Array.from(arguments);t.push(e.localState),o.handle(null,t)};s[t]={template:o,callback:r,name:t},i.addEventListener(t,r)};this.renderProcess=function(i,s){!function(){const n={};if(t.props)for(const o in t.props)n[o]=new d(t.props[o],e);r=new h(n,a()),o=e.appInstance.createComponentByName(t.component,r),f()}(),i.appendChild(n),s&&s.isFalse()||o.render(i)},this.unmountProcess=function(t){t&&(this.unmountAnchors(n.parentNode,n),!o)||(o.unmount(t),this.setIsUnmounted())},this.mountProcess=function(t){if(this.mountAnchors(),!t||!t.isFalse()){if(o.isRendered())o.mount();else{const t=document.createDocumentFragment();o.render(t),this.insertAfter(t,n)}this.setIsMounted()}},this.removeProcess=function(){n.remove(),o.remove(),this.setIsUnmounted()},this.target=function(){return o?o.getPublicMethod():null},E.apply(this,[{$viewDescription:t,$viewProps:e,$componentEventActions:s,$slotManagers:c,$callbacks:{getProps:()=>r,getElement:()=>o,getHbEvent:()=>i,getSlots:a,buildEvent:l,getSlotManagerObject:u}}])},A=function({$templateDescription:t}){this.disconnect=function(){this.emitUpdate=()=>{}},this.updateValueSource=function(e){t.refresh(e),this.emitUpdate()}},I={style:t=>Object.keys(t).map((e=>e+": "+t[e]+";")).join(" "),class:t=>Object.keys(t).filter((e=>t[e])).join(" ")},U=function(t,e,n,o){const r=new m(n,o),i={onUpdate:[]},s=["value","checked"],c=n=>{e&&(s.indexOf(e)>=0?t[e]=n:t&&"function"==typeof t.setAttribute&&t.setAttribute(e,n))};this.disconnect=()=>{},this.value=function(){const t=[];r.each((n=>{const o=n.hasAState?n.template.value():n.value;if("object"!=typeof o)return void t.push(o);const r=I[e]?I[e].apply(I,[o]):o;t.push(r)}));const n=t.filter((t=>null!=t&&""!==t));return 1===n.length?n[0]:n.join(" ")},this.onUpdate=function(t){i.onUpdate.push(t)},this.emitUpdate=function(){const t=this.value();var e,n;c(t),n=[t],i[e="onUpdate"]&&i[e].forEach((t=>{t.apply(t,n||[])}))},(()=>{c(this.value());o.getStateToUse().onUpdate(r.statesToWatch(),(()=>{this.emitUpdate()}))})(),A.apply(this,[{$templateDescription:r,$callbacks:{updateNodeAttribute:c}}])},P=function(t){this.onBeforeCreate=function(e){return t.beforeCreate.push(e),this},this.onCreated=function(e){return t.created.push(e),this},this.onBeforeMount=function(e){return t.beforeMount.push(e),this},this.onMounted=function(e){return t.mounted.push(e),this},this.onBeforeUnmount=function(e){return t.beforeUnmount.push(e),this},this.onUnmounted=function(e){return t.unmounted.push(e),this},this.onBeforeRemove=function(e){return t.beforeRemove.push(e),this},this.onRemove=function(e){return t.remove.push(e),this},this.onBeforeUpdate=function(e){return t.beforeUpdate.push(e),this},this.onUpdated=function(e){return t.updated.push(e),this},this.clearAll=function(){for(const e in t)t[e].slice()}};P.newListenersStore=function(){return{beforeCreate:[],created:[],beforeMount:[],mounted:[],beforeUnmount:[],unmounted:[],beforeRemove:[],removed:[],beforeUpdate:[],updated:[]}};const R=function(t){const e=(t,e)=>{t.forEach((t=>{t.apply(t,Array.from(e))}))};this.beforeCreate=function(){e(t.beforeCreate,arguments)},this.created=function(){e(t.created,arguments)},this.beforeUnmount=function(){e(t.beforeUnmount,arguments)},this.unmounted=function(){e(t.unmounted,arguments)},this.beforeMount=function(){e(t.beforeMount,arguments)},this.mounted=function(){e(t.mounted,arguments)},this.beforeRemove=function(){e(t.beforeRemove,arguments)},this.removed=function(){e(t.removed,arguments)},this.beforeUpdate=function(){e(t.beforeUpdate,arguments)},this.updated=function(){e(t.updated,arguments)}},C=function(t,e,n,o,r){const i={},s=new P(r);this.get=function(t){return i[t]},function(){for(const c in e){const u=new d(e[c],o),a=o.appInstance.createDirectiveInstance(c,[{element:t,attribute:u,attrs:n}]);for(const t in a){if(void 0===r[t])continue;const e="on"+t[0].toUpperCase()+t.substring(1);s[e].apply(s,[a[t]])}i[c]=a}}()},D=function(t,e,n){const o=[];let r=[...n];const i=[...e];return t.forEach(((t,e)=>{if(t===i[e])return void o.push({node:n[e],viewDescription:t});const s=function(t,e,n){let o=!1;const r=n.find(((n,r)=>{const i=n.getViewDescription();if(o=r===e,"string"==typeof i)return i===t;if(i.key&&i.key===t.key)return!0;if(i.ref&&i.ref===t.ref)return!0;if(JSON.stringify(i)===JSON.stringify(t))return!0;if(i.component&&i.component===t.component)return!0;const{content:s,...c}=i,{content:u,...a}=t;return JSON.stringify(c)===JSON.stringify(a)}));return{isSameIndex:o,element:r}}(t,e,r);if(s.element)return o.push({node:s.element,viewDescription:t}),void(r=r.filter((t=>t!==s.element)));o.push(t)})),o},N=function(t,e){const{content:n,...o}=t,{content:r,...i}=e;return JSON.stringify(o)!==JSON.stringify(i)},x=function({$viewDescription:t,$htmlAttributes:e,$viewProps:n,$htmlEventsStore:o,$callback:r}){const{getChildren:i,getHtmlNode:s,buildEventConnexion:c}=r;this.updateAttributes=function(o){let r={};o&&(r={...o}),Object.keys(e).forEach((t=>{if(!r[t])return s().removeAttribute(t),void e[t].disconnect();e[t].updateValueSource(r[t])}));for(const t in r){if(e[t])continue;const o=s();o&&(e[t]=new U(o,t,r[t],n))}t.attrs=r},this.updateEventHandlers=function(e){let n={};e&&(n={...e}),Object.keys(o).forEach((t=>{n[t]?o[t].updateAction(n[t]):o[t].disconnect()}));for(const t in e)o[t]||c(t,e);t.events=e},this.updateViewDescription=function(e){N(e,t)&&(this.updateAttributes(e.attrs),this.updateEventHandlers(e.events),this.updateIfControl(e.if));const n=i();n&&n.updateViewDescription(e.content),t.content=e.content}},O=function(n,o){if(n.if){const t=new l;t.parent=o.getStateToUse(),t.if=n.if,o={...o,localState:t}}w.call(this,{$viewDescription:n,$viewProps:o});const s=document.createComment((n.name||"DocumentFragment")+" Anchor "+(n.if?": If ("+n.if+")":"")),c={},u={},a=P.newListenersStore(),f=new R(a);let h=null,p=null,d=null;const m=function(t){if(!t)return null;g(!1);const e=new l;for(const n in c){if(!t.includes(n))continue;const o=e.add(n,c[n].value());c[n].onUpdate((t=>{o.set(t)}))}return e},g=function(t=!0){if(n.attrs)for(const e in n.attrs)c[e]=new U(h,t?e:"",n.attrs[e],o)},v=r=>{!function(){if(n.name!==e)h=n.name?document.createElement(n.name):document.createDocumentFragment(),g(),n.content&&(d=new M(n.content,o)),n.directives&&(p=new C(h,n.directives,c,o,a)),b();else{const e=o.componentInstance.getSlot(n.slot||t);if(h=document.createDocumentFragment(),!e)throw new Error("Undefined Slot name "+n.slot);d=e(h,m)}}(),d&&d.render(h),r&&r.append(h),f.created(),this.setAnchor(s)},y=function(t,e){const n=t.split("."),s=n.pop(),c=e[t],a=new S(c,o),f=function(t){n.includes(r)&&t.preventDefault(),n.includes(i)&&t.stopPropagation(),a.handle(t)};h.addEventListener(s,f),u[t]={name:s,callback:f,disconnect:()=>h.removeEventListener(s,f),updateAction:t=>a.refresh(t)}},b=function(){if(n.events)for(const t in n.events)y(t,n.events)};this.beforeRenderProcess=function(){f.beforeCreate()},this.renderProcess=function(t,e){t.appendChild(s),e&&e.isFalse()||v(t)},this.unmountProcess=function(t){f.beforeUnmount(),t&&(this.unmountAnchors(s.parentNode,s),!h)||(this.moveIntoFragment(h),h instanceof DocumentFragment&&d.unmount(),this.setIsUnmounted(),f.unmounted())},this.mountProcess=function(t){if(this.mountAnchors(),!t||!t.isFalse()){if(h||v(),f.beforeMount(),(n.content||n.name===e)&&null===d){const t=document.createDocumentFragment();return v(t),this.insertAfter(t,s),void this.setIsMounted()}this.moveIntoParent(),h instanceof DocumentFragment&&d.mount(),this.insertAfter(h,s),this.setIsMounted(),f.mounted()}},this.removeProcess=function(){f.beforeRemove(),h?(s.remove(),h.remove(),d&&d.remove(),this.setIsRemoved(),f.removed()):f.removed()},this.target=function(){return h},this.directive=function(){return p},x.apply(this,[{$viewDescription:n,$htmlAttributes:c,$viewProps:o,$htmlEventsStore:u,$callback:{getChildren:()=>d,getHtmlNode:()=>h,buildEventConnexion:y}}])},V=function(t,e){const n={iterableName:null,iterable:null,itemValueName:null,itemKeyName:null};this.test=function(n){return t.test(n)||e.test(n)},this.getExpressionDetails=function(o,r,i){e.test(o)&&(o=o.replace(/\(|\)/g,""));const s=o.match(t);if(!s||s.length<2)return null;const c=s[r+1];n.iterableName=c.split(".").shift(),n.iterable=c;const u=s[i+1].split(",").map((t=>t.trim()));return 1===u.length&&u.unshift("index"),n.itemValueName=u[1],n.itemKeyName=u[0]||"index",n},this.getIterableFullName=function(){return n.iterable},this.getIterableName=function(){return n.iterableName},this.getIterableItemKeyName=function(){return n.itemKeyName},this.getIterableItemValueName=function(){return n.itemValueName}},F=[function(){V.apply(this,[/^([a-z0-9_,\s$]+) in ([a-z0-9_.$]+)$/i,/^\(([a-z0-9_,\s$]+)\) in ([a-z0-9._$]+)$/i]),this.setExpression=function(t){return this.getExpressionDetails(t,1,0)}},function(){V.apply(this,[/^([a-z0-9_.$]+) as ([a-z0-9_,\s$]+)$/i,/^([a-z0-9_.$]+) as \(([a-z0-9_,\s$]+)\)$/i]),this.setExpression=function(t){return this.getExpressionDetails(t,0,1)}}],k=function(t,e){let n=null,o=null,r=null;this.getIterable=function(){return n.value()},this.expressionDescription=function(){return o},this.onUpdate=function(t){return n.onUpdate(t),t},this.refresh=function(t){if(t!==r){t=t.trim().replace(/[\s]+/," ");for(const i of F){const s=new i;if(s.test(t))return s.setExpression(t),o=s,n?n.refresh(o.getIterableFullName()):n=new d(o.getIterableFullName(),e),void(r=t)}throw new Error("Syntax Error : "+t)}},(()=>{this.refresh(t)})()},j=function({$loopTemplate:t,$keyTemplate:e,$viewDescriptionWithoutRepeat:n,$nodeInstancesByKey:o,$callbacks:r}){const{handleLoopExpression:i,getItemKeyName:s,updateIteration:c}=r;this.updateViewDescription=function(r){const{repeat:u,...a}=r;t.refresh(u),i(),e.refresh(r.key||s());const f=a.name&&n.name!==a.name,h=a.component&&n.component!==a.component;f||h?(o.store={},o.current={}):function(t){Object.values(o.store).forEach((({node:e})=>{(t.name&&n.name===t.name||t.component&&n.component===t.component)&&e.updateViewDescription(t)}))}(a),Object.keys(n).forEach((t=>{n[t]=void 0!==a[t]?a[t]:null})),c()}},T=function(t,e){w.call(this,{$viewDescription:t,$viewProps:e,$isFragment:!0});const n=document.createComment("Loop Anchor Start : "+t.repeat),o=document.createComment("Loop Anchor End : "+t.repeat),r={store:{},current:[],last:[]},i={...t};i.repeat=null;const s=new k(t.repeat,e);let c=null,u="",a="",f=new l({[u]:""});f.parent=e.getStateToUse();const h=new d("",{...e,localState:f});let p=!1;const m=()=>{c=s.expressionDescription(),c&&(u=c.getIterableItemKeyName(),a=c.getIterableItemValueName(),f.add(u,""))},g=()=>{p=!0,this.insertAfter(o,n),y(),s.onUpdate((()=>{y()}))},v=function(t,n){const o={[a]:t[n]};u&&(o[u]=n);const s=h.value(o);if(r.current.push(s),r.store[s]){const t=r.store[s];return t.data!==o[a]&&t.localState.set(o),t.localState.refreshProps(),void t.node.restoreRef()}const c=new l(o);c.parent=e.getStateToUse();const f=new M(i,{...e,localState:c});r.store[s]={node:f,data:o[a],localState:c}},y=function(){const n=s.getIterable();i.ref&&e.view.cleanReference(t.ref,!0);const o=Array.isArray(n);if(r.last=r.current,r.current=[],o)for(let t=0;t<n.length;t++)v(n,t);else for(const t in n)v(n,t);b()},b=function(){!function(){for(const t of r.last)r.current.includes(t)||(r.store[t].node.remove(),r.store[t]=null)}();for(const t of r.current){if(r.last.includes(t))continue;const e=document.createDocumentFragment(),n=r.store[t].node;n.isRendered()||(n.render(e),o.parentNode&&o.parentNode.insertBefore(e,o))}};this.renderProcess=function(t,e){t.appendChild(n),this.setAnchor(n),e&&e.isFalse()||g()},this.unmountProcess=function(t){this.setParent(null);for(const t of r.current)r.store[t].node.unmount();if(t){const t=[n];let e=n;for(;e.nextSibling!==o;)e=e.nextSibling,e instanceof Comment&&t.push(e);t.push(o),this.unmountAnchors(n.parentNode,t)}this.setIsUnmounted()},this.mountProcess=function(t){if(this.mountAnchors(),!t||!t.isFalse()){if(p)for(const t of r.current)r.store[t].node.mount();else g();this.setIsMounted()}},this.removeProcess=function(){for(const t of r.current)r.store[t].node.remove();n.remove(),o.remove(),this.setIsRemoved()},j.apply(this,[{$loopTemplate:s,$keyTemplate:h,$nodeInstancesByKey:r,$viewDescriptionWithoutRepeat:i,$callbacks:{handleLoopExpression:m,updateIteration:y,getItemKeyName:()=>u}}]),m(),h.refresh(i.key||u)},L=function({$viewDescription:t,$fragmentElements:e,$callbacks:n}){const{handleViewDescriptionElement:o,getParentNode:r,buildViewDescription:i}=n;this.updateViewDescription=function(n,s){if(typeof t!=typeof n||"object"==typeof t&&Array.isArray(t)===Array.isArray(n))return e.forEach((t=>{t.remove()})),e.splice(0),i(n),void function(t){(t=t||r())&&e.forEach((e=>{e.render(t)}))}(s);const c=e[0];if("string"!=typeof n){if("object"==typeof n)if(Array.isArray(n)){Array.isArray(t)||(t=[]);const i=D(n,t,e);t.splice(0),t.push(...n);const c=[];e.forEach((t=>{t.unmount(!0);i.find((e=>e?.node===t))||(t.remove(),c.push(t))})),c.forEach((t=>{const n=e.findIndex((e=>e===t));e.splice(n,1)}));let u=[];i.forEach((t=>{if(t?.node&&t.node instanceof M)return t.node.mount(),t.viewDescription?.if?u=[t.viewDescription.if]:t.viewDescription?.elseif&&u.push(t.viewDescription.elseif),void(t.viewDescription&&t.node.updateViewDescription(t.viewDescription));if(t){o(t,u).render(s||r())}}))}else n&&c.updateViewDescription(n)}else c.updateViewDescription(n)}},M=function(t,e){w.call(this,{$viewDescription:t,$viewProps:e,$isFragment:!0});const n=[];let o=null,r=null;const i=function(t,o){if("string"==typeof t){const o=new M(t,e);return n.push(o),o}const r={...t};if(t.if)o.push(t.if);else if(""===t.else){if(0===o.length)throw new Error("Else without If");r.if=B(o)}else if(t.elseif){if(0===o.length)throw new Error("ElseIf without If");r.if=B(o,t.elseif),o.push(t.elseif)}else o.splice(0);const i=new M(r,e);return n.push(i),i},s=function(t){if(!t)return;if("string"==typeof t){const o=new b(t,e);return void n.push(o)}if("object"!=typeof t)return;if(t.repeat){const o=new T(t,e);return void n.push(o)}if(Array.isArray(t))return void function(t){const e=[];for(const n of t)i(n,e)}(t);if(t.component){const r=new $(t,e);return n.push(r),void(t.ref&&(e.view.setReference(t.ref,r),o=r))}const r=new O(t,e);n.push(r),t.ref&&(e.view.setReference(t.ref,r),o=r)};this.build=function(){e.componentInstance&&s(t)},this.restoreRef=function(){o&&t.ref&&e.view.setReference(t.ref,o)},this.renderProcess=function(t){r=t,this.build();for(const e of n)e.render(t)},this.unmountProcess=function(t){for(const e of n)e.unmount(t);this.setIsUnmounted()},this.mountProcess=function(t){if(!t||!t.isFalse()){for(const t of n)t.mount();this.setIsMounted()}},this.removeProcess=function(){for(const t of n)t.remove();this.setIsRemoved()},L.apply(this,[{$viewDescription:t,$fragmentElements:n,$callbacks:{handleViewDescriptionElement:i,buildViewDescription:s,getParentNode:()=>r}}])},_=function(t){return/^\(/.test(t)&&/\)$/.test(t)?t:"("+t.trim()+")"},B=function(t,e=null){const n="!("+t.map(_).join("||")+")";return e?n+" && ("+_(e)+")":n},q=function(){const t=[];this.clean=function(){t.splice(0)},this.push=function(e){t.push(e)},this.get=function(e){return t[e]?.target()},this.props=function(t){const e=[];return this.each((function(n){e.push(n?n[t]:void 0)})),e},this.each=function(e){t.forEach((function(t){e(t.target())}))}},H=function({$viewFragment:t,$viewAnchor:e,$viewAnchorEnd:n}){const o=document.createDocumentFragment();this.putInRenderBox=function(t,e){let n=t.nextSibling;for(;n!==e&&n;){const t=n;n=n.nextSibling,o.appendChild(t)}},this.renderRenderBox=function(t){this.insertAfter(o,t)},this.updateViewDescription=function(r){this.putInRenderBox(e,n),t.updateViewDescription(r,o),this.renderRenderBox(e)}},J=function(t,e){const n=document.createComment(""),o=document.createComment("");let r=null;const i={view:this,appInstance:e,componentInstance:null,localState:null,getState:null,getStateToUse:function(){return this.localState?this.localState:this.componentInstance.getState()}};w.call(this,{$viewDescription:t,$viewProps:i});const s=new M(t,i),c={},u={};let a=null;this.renderProcess=function(t,e){r=t,t.appendChild(n),e&&e.isFalse()||(s.render(t),t.appendChild(o))},this.unmountProcess=function(t){t&&this.unmountAnchors(n.parentNode,n),s.unmount(t),this.setIsUnmounted()},this.mountProcess=function(t){if(this.mountAnchors(),!t||!t.isFalse()){if(s.isRendered())s.mount();else{const t=document.createDocumentFragment();s.render(t),this.insertAfter(t,n)}this.setIsMounted()}},this.removeProcess=function(){s.remove(),this.setIsRemoved()},this.setComponentInstance=function(t){i.componentInstance=t,i.getState=function(e){if(this.localState){const t=this.localState.get(e);if(t)return t}return t.getStateByName.apply(i.componentInstance,[e])},a=t,n.textContent=t.getName()+" Component View Anchor",o.textContent=t.getName()+" Component View End Anchor"},this.setReference=function(t,e){const n=function(t){const e={};return["target"].forEach((n=>{t[n]&&(e[n]=function(){return t[n].apply(t,Array.from(arguments))})})),{...e}}(e);if(u[t]instanceof q)return u[t].push(n),void(void 0===c[t]&&Object.defineProperty(c,t,{get:function(){return u[t]}}));u[t]=n,void 0===c[t]&&Object.defineProperty(c,t,{get:function(){return u[t]?.target()}})},this.cleanReference=function(t,e){if(!0===e)return u[t]instanceof q?void u[t].clean():void(u[t]=new q);u[t]=void 0},this.getReferences=function(){return c},this.getComponentInstance=function(){return a},this.getAnchor=function(){return n},H.apply(this,[{$viewFragment:s,$viewAnchor:n,$viewAnchorEnd:o,$callbacks:{getParentNode:()=>r}}])},W=["ref","if","else","elseif","repeat"],z=["fragment","habame"],K=function(n){const o={},r=n.tagName;if(r&&!z.includes(r.toLowerCase())){const t=r[0];t===t.toUpperCase()?o.component=r:o.name=r}if(n.children&&n.children.length>0){const r=[],i=[];Array.from(n.childNodes).forEach((n=>{if(n instanceof Comment)return;const o=K(n);if("slot-fragment"===o.name){if(!o.attrs.name)throw new Error("Slot name is required");return o.props&&(o.props=Object.keys(o.props)),o.name="",void(i[o.attrs.name]=o)}o.name===e&&(o.slot=o.attrs&&o.attrs.name||t),r.push(o)})),o.content=r,o.slots=i}else n.textContent&&(o.content=n.textContent);const i=function(t){if(!t.getAttributeNames)return{};const e={};return t.getAttributeNames().forEach((function(n){const o=n.split("."),r=t.getAttribute(n);if(1===o.length)return W.includes(n.toLowerCase())?void(e[n]=r):(e.attrs=e.attrs||{},void(e.attrs[n]=r));const i=o.shift(),s=o.join(".");e[i]||(e[i]={}),e[i][s]=r})),e}(n);if(void 0===o.name&&void 0===o.component&&0===Object.keys(i).length)return o.content;for(const t in i)o[t]=i[t];return o},G=function(t){return JSON.parse(JSON.stringify(t))},X=function(t,e,n){let o=t;const r=t=>{if(n&&n.engines){("string"==typeof n.engines?[n.engines]:n.engines).forEach((e=>{const n=window.Habame.getViewEngine(e);t=n(t)}))}return!0===n.disableXmlEngine||"string"==typeof t&&(t=function(t){if(""===t)return{content:""};let e=t;t instanceof Document||(e=(new DOMParser).parseFromString(`<habame>${t}</habame>`,"application/xhtml+xml"));return e.querySelector("parsererror")?[]:K(e.activeElement)}(t)),t};this.create=function(){const t="string"==typeof o?o:G(o);return new J(t,e)},this.updateViewDescription=function(t){return o=r(t),o},o=r(t)},Y=function({$lifecycle:t,$event:e,$componentRequirements:o,$state:r}){const i=[];this.updateController=function(i){const s=r.getAll();t.clearAll(),e.clearAll();for(const t in o.Actions)o.Actions[t]=void 0;i(o),o.State.useProps(o.Props);const c={};for(const t in s)if(r.exists(t)){const e=r.get(t),o=e.value(),i=s[t];if(typeof o!=typeof i)continue;if("object"==typeof i)try{if(JSON.stringify(e.getInitialValue())!==JSON.stringify(o))continue}catch(t){continue}else if(e.getInitialValue()!==o)continue;c[t]=i[n]?i.toObject():i}r.set(c),this.handleListeners()},this.handleListeners=function(){i.forEach((t=>{t&&t()}))},this.onControllerUpdated=function(t){i.push(t)},this.removeControllerUpdatedListener=function(t){const e=i.findIndex((e=>t===e));i.splice(e,1)}},Q=function(t,e,n,o,r,i){const c={},u=new s,a=new l({},i),f=P.newListenersStore(),p=new P(f),d=new R(f),m=e.getReferences();a.parent=r.getState(),a.App=r.getState(),o instanceof h&&a.useProps(o);const g={App:r,Actions:c,HbEvent:u,State:a,Props:o,Lifecycle:p,Refs:m},v=n(g,e);Y.apply(this,[{$lifecycle:p,$event:u,$componentRequirements:g,$state:a}]),this.render=function(t){d.beforeCreate(),e.render(t),d.created()},this.getView=function(){return e},this.isRendered=function(){return e.isRendered()},this.unmount=function(t){d.beforeUnmount(),e.unmount(t),d.unmounted()},this.mount=function(){d.beforeMount(),e.mount(),d.mounted()},this.remove=function(){d.beforeRemove(),e.remove(),a.disconnect(),u.disconnect(),d.removed()},this.getStateByName=function(t){return a.get(t)},this.getState=function(){return a},this.getName=function(){return t},this.getActions=function(){return c},this.getHbEvent=function(){return u},this.getSlot=function(t){return o.getSlot(t)},this.getPublicMethod=function(){return v?{...v}:{}},(()=>{for(const t in c)c[t]=c[t].bind(c);e.setComponentInstance(this)})()},Z=function(t,e,n,o){const r=[],i={view:n,controller:e,options:o};let s=null;this.create=function(e,n,c){const u=function(t){return null===s&&(s=new X(i.view,t,o)),s.create()}(n),a=new Q(t,u,i.controller,e,n,c);return r.push({component:a,view:u}),a},this.updateController=function(t){i.controller=t,r.forEach((({component:e})=>{e.updateController(t)}))},this.updateView=function(t){if(i.view=t,!s)return;const e=s.updateViewDescription(t);r.forEach((({view:t})=>{const n="string"==typeof e?e:G(e);t?.updateViewDescription(n)}))},this.updateControllerAndView=function(t,e){this.updateController(e),this.updateView(t)}},tt=function(t,e){const n=new s,o=new l,r=(t,n)=>t.create(n,this,e);this.createDirectiveInstance=function(t,n){return e.getDirectiveFactory(t).create(n)},this.createComponentByName=function(t,e){const n=t instanceof Z?t:window.Habame.getComponentFactory(t);return e=e||new h,r(n,e)},this.getEvent=function(){return n},this.getState=function(){return o},this.getApp=function(t){return e.getApp(t)},this.render=function(e){const n="string"==typeof e?this.createComponentByName(e,null):r(e,null);return n.render(t),n}},et=function(t,e){this.create=function(t){return new e(...t)}},nt=function(t,e){let n=null;const o=function(){const n=new l,o=Array.isArray(e.params)?e.params:[],r=new t(n,...o);return r.$serviceState=n,r};this.create=function(){return!1===e.isUniqueInstance?o():(n||(n=o()),n)},this.definition=function(){return t}};const ot="Router",rt={name:"a",content:{name:"yield-fragment"},attrs:{href:"{{ href }}"},events:{"prevent.click":"push"}};const it=function(t){return null==t?null:t.replace(/^[/]+/,"").replace(/[/]+$/,"").replace(/[/]+/g,"/").trim()},st=function(t){const e={required:[],params:{},search:null,hash:null},n=t.groups(),o={name:"",path:null,isUniqueInstance:!0,component:null,redirectTo:null,middlewares:[],where:{}},r=function(t){return{name:t.trim()}};this.params=function(){return{...e.params}},this.hash=function(){return e.hash},this.query=function(){return new URLSearchParams(e.search)},this.router=function(){return t},this.getPath=function(){return o.path},this.isUniqueInstance=function(){return e.isUniqueInstance},this.getState=function(){return{params:this.params(),query:this.query().toString(),hash:this.hash()}},this.path=function(t,e){if(!t&&""!==t)throw new Error("Undefined path");return o.path=n.getPath(it(t)),e?(o.component=e,this):this},this.name=function(e){return o.name=n.getName(e),t.setNamedRoute(e,this),this},this.dontUseUniqueInstance=function(){return o.isUniqueInstance=!1,this},this.redirectTo=function(t){return o.redirectTo=t,this},this.middlewares=function(){if(0===arguments.length)throw new Error("Route Middlewares : provide the middlewares names");return o.middlewares=n.getMiddlewares(Array.from(arguments)),this},this.where=function(t){return o.where=t,this},this.isMatch=function(t){if(null===o.path)return!1;if(null==t)return!1;const n=new URL(t,location.origin),i=function(){const t=o.path.replace(/\{(.*?)}/g,(function(t,n){const i=r(n);return e.required.push(i),o.where[i.name]?"("+o.where[i.name].replace(/\(/g,"(?:")+")":"(.*?)"}));return new RegExp("^"+t+"$")}(),s=it(n.pathname);return!!i.test(s)&&(e.search=n.search||null,e.hash=n.hash||null,function(t,n){const o=t.match(n);o.shift();const r={};e.required.forEach(((t,e)=>{r[t.name]=o[e]})),e.params=r}(s,i),!0)},this.getName=function(){return o.name},this.getPath=function(){return o.path},this.getMiddlewares=function(){return o.middlewares||[]},this.getComponent=function(){return o.component},this.set=function(t,n,o){e.params=t,e.search=n||null,e.hash=o||null},this.getUrl=function(t,n,i){t=t||e.params,n=n||e.search,i=i||e.hash;let s=o.path.replace(/\{(.*?)}/g,(function(e,n){const o=r(n);if(void 0===t[o.name])throw new Error("Route param required: "+o.name);return encodeURIComponent(t[o.name])}));return n&&("string"==typeof n&&(s+="?"+n),"object"==typeof n&&(s+="?"+new URLSearchParams(n).toString())),i&&(s+="#"+i),"/"+s}},ct=function(){let t=null,e=[],n=-1;const o=function(){if(n++,!e[n])return;const r=e[n];"function"==typeof r&&r(t,o)};this.handle=function(r,i){t=i,e=r,n=-1,o()}},ut=function(){this.push=function(t){const e=t.route;history.pushState({...e.getState(),uuid:t.uuid},"",e.getUrl())},this.back=function(){history.back()},this.forward=function(){history.forward()},this.getCurrentLocation=function(){return location.pathname.replace(/\+$/,"").replace(/^\+/,"")+location.search},this.useService=function(t){window.addEventListener("popstate",(e=>{e.state&&e.state.uuid&&t.moveTo(e.state.uuid)}))}},at={name:"div",ref:"routerRenderContainer",attrs:{id:"{{ id }}"}};var ft={DynamicComponent:function(t){t.createComponent("DynamicComponent",(function({State:t,Props:e,App:n,Lifecycle:o},r){const i={},s={component:null,name:null};t.disconnectProps();const c=function(){const t=e.use;if(!t)throw new Error("Props *use* required");if(s.name!==t){if(s.component&&s.component.unmount(),i[t])i[t].component.mount();else{const o=n.createComponentByName(e.use,e),s=o.getView(),c=document.createDocumentFragment();o.render(c),s.insertAfter(c,r.getAnchor()),i[t]={component:o,fragment:c}}s.component=i[t].component,s.name=t}};e.onUpdate("use",c),o.onCreated(c)}),"")},Link:function(t){t.createComponent("Link",(function({State:e,Props:n,Actions:o}){e.init({href:""});const r=n.router||ot,i=t.Router.getRouter(r);if(!i)throw new Error("Undefined Router "+(n.router||ot));if(n.to&&!i.routeExists(n.to))throw new Error("Undefined route name "+n.to);const s=function(){if(n.to){const t=i.getRouteByName(n.to);return t.set(n.params||{},n.query,n.hash),t}return i.getRouteByPath(n.href)},c=function(){const t=s();e.href=t.getUrl()};o.push=function(){const t=s();i.push(t)},c(),n.to?n.onUpdate("to",(()=>c())):n.href&&n.onUpdate("href",(()=>c()))}),rt)},Router:function(t){t.createComponent("Router",(function({Props:e,State:n,Refs:o,App:r,Lifecycle:i}){n.init({id:e.id||""});const s=new ct,c={},u=t.Services[e.name||ot];n.useService(u);let a=null;const f=function(t){if(!o.routerRenderContainer)return;let e=t.getPath();if(t.isUniqueInstance()||(e=t.getUrl()),c[e])return a=c[e],a.mount(),c[e];a=r.createComponentByName(t.getComponent(),null),c[e]=a,a.render(o.routerRenderContainer)};n.get("$route").onUpdate((t=>{if(a&&a.unmount(),!(t instanceof st))return;const e=t.getMiddlewares();e.push(f),s.handle(e,t)})),i.onCreated((()=>{const t=u.historyHandler();t&&"function"==typeof t.getCurrentLocation?(u.push(t.getCurrentLocation()),t instanceof ut&&t.useService(u)):u.push("/")}))}),at)}};const ht=function(t){const e={prefix:null,name:null,middlewares:[]};this.prefix=function(t){return e.prefix=t,this},this.name=function(t){return e.name=t,this},this.middlewares=function(){return e.middlewares=Array.from(arguments),this},this.getName=function(){return e.name},this.getPrefix=function(){return e.prefix},this.getMiddlewares=function(){return e.middlewares},this.group=function(e){t.groups().addGroup(this),e(),t.groups().removeGroup(this)}},lt=function(){let t=[];this.addGroup=function(e){t.push(e)},this.removeGroup=function(e){t=t.filter((t=>e!==t))},this.getName=function(e){const n=[];return t.forEach((t=>{const e=t.getName();e&&n.push(e)})),e&&n.push(e),n.join("")},this.getPath=function(e){const n=[];return t.forEach((t=>{const e=t.getPrefix();e&&n.push(e)})),e&&n.push(e),n.join("/")},this.getMiddlewares=function(e){let n=[];return t.forEach((t=>{const e=t.getMiddlewares();e&&(n=n.concat(e))})),e&&(n=n.concat(e)),n}},pt=function(t,e){const n=new lt,o={},r=[];let i=null,s=null;this.setNamedRoute=function(t,e){o[t]=e},this.getRouterService=function(){return s||(s=e.Services[t],s)},this.path=function(t,e){const n=new st(this);return n.path(t,e),r.push(n),n},this.notFound=function(t,e){const n=new st(this);n.path(t,e),i=n},this.prefix=function(t){return new ht(this).prefix(t)},this.name=function(t){return new ht(this).name(t)},this.middlewares=function(){return new ht(this).middlewares(...arguments)},this.groups=function(){return n},this.routeExists=function(t){return void 0!==o[t]},this.getRouteByName=function(t){if(!o[t])throw new Error("Undefined route "+t);return o[t]},this.getRouteByPath=function(t){const e=it(t);for(const t of r)if(t.isMatch(e))return t;if(!i)throw new Error("Route not found: "+t);return i},this.get=function(t){if(t instanceof st)return t;if("object"==typeof t){const e=this.getRouteByName(t.name);if(e)return e.set(t.params,t.query,t.hash),e}if("string"==typeof t){const e=this.getRouteByPath(t);if(e)return e}return i},this.push=function(t){if(!t)throw new Error("Router.push params require a valid param");const e=this.get(t);if(!e)throw new Error("Route not found");this.getRouterService().pushRoute(e)}},dt=function(t,e,n){const o=[],r=[];let i=-1,s=null;t.init({$route:null});const c=function(t){const e=o[t],n=e.state;return e.route.set(n.params,n.query,n.hash),e};this.onChange=function(t){if("function"==typeof t)throw new Error("onChange require a function, "+typeof t+" given");r.push(t)},this.historyHandler=function(){return n},this.pushRoute=function(e){if(!(e instanceof st))return;const c=(new Date).getTime(),u={route:e,state:e.getState(),url:e.getUrl(),uuid:c};o.splice(i+1),o.push(u),i++,n&&n.push(u);const a=t.$route===e&&s!==u.url;t.$route=e,s=u.url,a&&t.get("$route").trigger(),function(t){r.forEach((e=>{e(t)}))}(e)},this.push=function(t){this.pushRoute(e.get(t))},this.moveTo=function(e){let n=null;o[i-1]?.uuid===e?(i--,n=o[i]):o[i+1]?.uuid===e&&(i++,n=o[i]),n&&(t.$route=n.route)},this.back=function(){if(i-1<0)return;i--;const e=c(i);n&&n.back(e.route),t.$route=e.route},this.forward=function(){if(!o[i+1])return;i++;const e=c(i);n&&n.forward(e.route),t.$route=e.route}},mt=function(){const t={},e={},n={},o={};let r={},i=null;const s={Services:{},createRoot:function(t,e=null){"string"==typeof t&&(t=document.getElementById(t));const n=new tt(t,s);return e&&(o[e]=n),n},setDefaultViewEngine:function(t,e){e&&this.addViewEngine(t,e),i=t},addViewEngine:function(t,e){if(void 0===r[t]){if("function"!=typeof e)throw new Error("View Engine "+t+" must be a function");r[t]=e}},getViewEngine:function(t){return r[t]},createComponent:function(e,n,o,r={}){r.engines=r.engines||i;const s=new Z(e,n,o,r);return t[e]=s,s},createService:function(t,e,o){const r=new nt(e,o||{});n[t]=r,Object.defineProperty(mt.Services,t,{get:()=>r.create()})},getServices:function(){return n},getComponentFactory:function(e){const n=t[e];if(!n)throw new Error("Component "+e+" not found");return n},isComponentFactoryExists:function(e){return!!t[e]},createDirective:function(t,n){const o=new et(t,n);return e[t]=o,o},getDirectiveFactory:function(t){const n=e[t];if(!n)throw new Error("Directive "+t+" not found");return n},getApp:function(t){return o[t]}};s.Router=function(t){const e={};return{createRouter:function(n,o){if(e[n=n||ot]instanceof pt)throw new Error("router : "+n+" already exists");const r=new pt(n,t);let i=null;return o&&!0===o.browserHistory?i=new ut:o&&o.history&&(i=o.history),t.createService(ot,dt,{params:[r,i]}),e[n]=r,r},createBrowserRouter:function(){return t.Router.createRouter(null,{browserHistory:!0})},getRouter:function(t){if(!(e[t=t||ot]instanceof pt))throw new Error("Undefined router "+t);return e[t]}}}(s);const c=Object.values(ft);for(const t of c)"function"==typeof t&&t(s);return s}();return mt}();
